<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Uil spritesheet vergelijking (HQ, GitHub proof)</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #f2f2f2;
      font-family: Arial, sans-serif;
      color: #222;
    }

    #game {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Belangrijk: voorkom geforceerde pixelated canvas rendering */
    canvas {
      max-width: 100%;
      max-height: 100%;
      image-rendering: auto;
    }

    .hint {
      position: fixed;
      left: 12px;
      bottom: 12px;
      font-size: 14px;
      color: #333;
      background: rgba(255,255,255,0.92);
      padding: 10px 12px;
      border-radius: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.06);
      white-space: nowrap;
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 6px;
      background: rgba(0,0,0,0.08);
    }
  </style>
</head>
<body>

<div id="game"></div>

<div class="hint">
  <span class="pill">Klik of tik: pauze</span>
  <span class="pill"><span class="kbd">plus</span> sneller</span>
  <span class="pill"><span class="kbd">min</span> langzamer</span>
  <span class="pill"><span class="kbd">F</span> filtering: LINEAR of NEAREST</span>
  <span class="pill"><span class="kbd">1</span><span class="kbd">2</span><span class="kbd">3</span> grootte: 220, 256, 320</span>
  <span class="pill" id="filterStatus">Filtering: LINEAR</span>
  <span class="pill" id="sizeStatus">Weergave: 220 px</span>
</div>

<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>

<script>
  // Bestandsnamen naast deze HTML
  const SHEETS = [
    { key: "owl512", file: "owl_idle_fixed_512.png", frame: 512, label: "512 px per frame" },
    { key: "owl256", file: "owl_idle_fixed_256.png", frame: 256, label: "256 px per frame" },
    { key: "owl128", file: "owl_idle_fixed_128_hq.png", frame: 128, label: "128 px per frame" }
  ];

  // GitHub proof: render op hogere resolutie om canvas scaling artefacts te verminderen
  const DPR = Math.min(window.devicePixelRatio || 1, 2);

  let paused = false;
  let frameRate = 6;

  // Start met LINEAR, dit is doorgaans mooier bij schalen
  let useLinear = true;

  // Schaal presets: hiermee kun je eerlijk vergelijken
  const SIZE_PRESETS = [220, 256, 320];
  let sizeIndex = 0;
  let targetDisplaySize = SIZE_PRESETS[sizeIndex];

  const config = {
    type: Phaser.AUTO,
    parent: "game",
    width: 1100,
    height: 520,
    backgroundColor: "#f2f2f2",
    resolution: DPR,
    render: {
      antialias: true,
      roundPixels: false
    },
    scale: {
      mode: Phaser.Scale.FIT,
      autoCenter: Phaser.Scale.CENTER_BOTH
    },
    scene: { preload, create }
  };

  new Phaser.Game(config);

  function preload() {
    SHEETS.forEach(s => {
      this.load.spritesheet(s.key, s.file, {
        frameWidth: s.frame,
        frameHeight: s.frame
      });
    });
  }

  function create() {
    const scene = this;

    // Animaties
    SHEETS.forEach(s => {
      scene.anims.create({
        key: s.key + "_idle",
        frames: scene.anims.generateFrameNumbers(s.key, { start: 0, end: 3 }),
        frameRate,
        repeat: -1
      });
    });

    // Layout
    const marginX = 60;
    const centerY = 280;
    const colW = (config.width - marginX * 2) / 3;

    const sprites = [];
    const metaTexts = [];

    SHEETS.forEach((s, i) => {
      const x = marginX + colW * i + colW / 2;

      const sprite = scene.add.sprite(x, centerY, s.key);
      sprite.setOrigin(0.5, 0.5);

      sprite.play(s.key + "_idle");
      sprites.push(sprite);

      scene.add.text(x, 70, s.label, {
        fontFamily: "Arial",
        fontSize: "18px",
        color: "#222"
      }).setOrigin(0.5, 0.5);

      const meta = scene.add.text(x, 98, "", {
        fontFamily: "Arial",
        fontSize: "14px",
        color: "#444"
      }).setOrigin(0.5, 0.5);

      metaTexts.push(meta);
    });

    const setMeta = () => {
      metaTexts.forEach((t, i) => {
        const s = SHEETS[i];
        const scale = targetDisplaySize / s.frame;
        t.setText(`frame: ${s.frame}Ã—${s.frame}, schaal: ${scale.toFixed(3)}`);
      });
      document.getElementById("sizeStatus").textContent = `Weergave: ${targetDisplaySize} px`;
    };

    const applyScale = () => {
      sprites.forEach((sp, i) => {
        const s = SHEETS[i];
        sp.setScale(targetDisplaySize / s.frame);
      });
      setMeta();
    };

    const applyFiltering = () => {
      const mode = useLinear
        ? Phaser.Textures.FilterMode.LINEAR
        : Phaser.Textures.FilterMode.NEAREST;

      SHEETS.forEach(s => {
        const tex = scene.textures.get(s.key);
        if (tex && tex.setFilter) tex.setFilter(mode);
      });

      document.getElementById("filterStatus").textContent =
        `Filtering: ${useLinear ? "LINEAR" : "NEAREST"}`;
    };

    const setAnimSpeed = () => {
      SHEETS.forEach(s => {
        const anim = scene.anims.get(s.key + "_idle");
        if (anim) anim.frameRate = frameRate;
      });

      sprites.forEach(sp => {
        const a = sp.anims.currentAnim;
        if (a) a.frameRate = frameRate;
      });
    };

    // Init
    applyScale();
    applyFiltering();
    setAnimSpeed();

    // Klik of tik: pauze
    scene.input.on("pointerdown", () => {
      paused = !paused;
      sprites.forEach(sp => paused ? sp.anims.pause() : sp.anims.resume());
    });

    // Toetsen
    scene.input.keyboard.on("keydown", (ev) => {
      const key = ev.key;

      if (key === "f" || key === "F") {
        useLinear = !useLinear;
        applyFiltering();
        return;
      }

      if (key === "+" || key === "=") {
        frameRate = Phaser.Math.Clamp(frameRate + 1, 1, 24);
        setAnimSpeed();
        return;
      }

      if (key === "-" || key === "_") {
        frameRate = Phaser.Math.Clamp(frameRate - 1, 1, 24);
        setAnimSpeed();
        return;
      }

      if (key === "1") {
        sizeIndex = 0;
        targetDisplaySize = SIZE_PRESETS[sizeIndex];
        applyScale();
        return;
      }

      if (key === "2") {
        sizeIndex = 1;
        targetDisplaySize = SIZE_PRESETS[sizeIndex];
        applyScale();
        return;
      }

      if (key === "3") {
        sizeIndex = 2;
        targetDisplaySize = SIZE_PRESETS[sizeIndex];
        applyScale();
        return;
      }
    });
  }
</script>

</body>
</html>
